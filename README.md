# 概述

对 hanlp 1.x 基于词典的分词源码分析学习 .

hanlp 本身都是 static method, 不是很适合多词典的方式 , 这里稍微改造下. 使用 fastutil 优化下数据结构 .

基本上 trie 树都是非常占据内存的, 但是似乎没有考虑到对 cpu 多级缓存的充分使用. 这里考虑优化下 .

后续考虑废弃掉业务上 对 dict 分词的依赖, 但是目前审核场景 依旧严重依赖词典的分词, 所以还是要维护一份 .

# 双数组 trie 树的原理分析.

> 入门要下面4个要点

核心就是假设有一个前缀 . prefix = "whatever";

要点1: 在 base 数组的位置, 表达的是 prefix 的状态, 这个值非常的关键. 假设是 x !!!!!!!!!

要点2: 我们要 给 x 设置值, 需要知道 prefix 有关系的所有儿子. 直接的儿子.

- 假设此时的儿子是: 'a', 'b', 'c'. 也就是说, 还有的前缀是 'whatever' + 'a' .... 一直到 'whatever' + 'c'

要点3: 求 charAt('业务字符') 的时候要额外 + 1, 因为用 '\0' = 0 表达结尾, 这个先不管, 只要知道 算 char 转整数 要 + 1 即可 .


要点4: 如何表达 prefix 和 children  之间的关系, 通过 check[] 数组的值表示 . 

- 例如, 表达 prefix 到 a 这个路径存在, 就要把 check[x + codeOf('a'') + 1] 这个位置的值设置为 x .


要点5 : 所以算法变为如何给 x 选择一个值. 其实就是 check 对应的数组地方有位置就可以了 ? 这点不是很确认 .